pipeline {
    agent any
    // environment {
    //     AWS_ACCESS_KEY_ID     = credentials('aws-access')  // 'aws-access-key' is the ID you gave while storing the credentials
    //     AWS_SECRET_ACCESS_KEY = credentials('aws-access')  // If you stored access key and secret key separately
    //  }
        stages {
            
            stage('Checkout') {
                steps {
                     git branch: 'main', credentialsId: 'git-token', url: 'https://github.com/Amira-sherif/https://github.com/Amira-sherif/CI-CD-project-V0/'
                     }
            }
            stage('Check Terraform') {
              steps {
                  sh 'terraform --version'
                     }
                
            }
            stage('init Terraform') {
            steps {
                sh 'terraform init'
                    }
                                }    
                
          stage('Terraform apply') {
                steps {
                 sh 'terraform apply  --auto-approve'
                      }
                                  }
          stage('cp files to remote server') {
                steps {
                 sh 'scp -r /var/lib/jenkins/workspace/ansible-pipe/* root@18.212.149.45:~/project
'
                      }
                                  }
          stage('apply ansible-playbook') {
                steps {
                 sh 'ansible-playbook /var/lib/jenkins/deployment.yml'
                      }
                                  }


        }
 
    }
